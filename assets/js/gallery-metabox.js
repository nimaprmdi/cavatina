jQuery(function(i){var l;function t(){i("#gallery-metabox-list li").each(function(e){i(this).find("input:hidden").attr("name","vdw_gallery_id["+e+"]")})}function a(){i("#gallery-metabox-list").sortable({opacity:.6,stop:function(){t()}})}i(document).on("click","#gallery-metabox a.gallery-add",function(e){e.preventDefault(),l&&l.close(),(l=wp.media.frames.file_frame=wp.media({title:i(this).data("uploader-title"),button:{text:i(this).data("uploader-button-text")},multiple:!0})).on("select",function(){var a=i("#gallery-metabox-list li").index(i("#gallery-metabox-list li:last"));l.state().get("selection").map(function(e,t){e=e.toJSON(),index=a+(t+1),i("#gallery-metabox-list").append('<li><input type="hidden" name="vdw_gallery_id['+index+']" value="'+e.id+'"><img class="image-preview" src="'+e.sizes.thumbnail.url+'"><a class="change-image button button-small" href="#" data-uploader-title="Change image" data-uploader-button-text="Change image">Change image</a><br><small><a class="remove-image" href="#">Remove image</a></small></li>')})}),a(),l.open()}),i(document).on("click","#gallery-metabox a.change-image",function(e){e.preventDefault();var t=i(this);l&&l.close(),(l=wp.media.frames.file_frame=wp.media({title:i(this).data("uploader-title"),button:{text:i(this).data("uploader-button-text")},multiple:!1})).on("select",function(){attachment=l.state().get("selection").first().toJSON(),t.parent().find("input:hidden").attr("value",attachment.id),t.parent().find("img.image-preview").attr("src",attachment.sizes.thumbnail.url)}),l.open()}),i(document).on("click","#gallery-metabox a.remove-image",function(e){e.preventDefault(),i(this).parents("li").animate({opacity:0},200,function(){i(this).remove(),t()})}),a()});